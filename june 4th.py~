#!/usr/bin/env python
import sys
import numpy as np
import matplotlib.pyplot as plt
import matplotlib as mlp
import ScopeTrace
import pylandau

#---------------------------------------------------------------------------------------------------
# M A I N
#---------------------------------------------------------------------------------------------------
# initial settings
mlp.rcParams['axes.linewidth'] = 2

for filename in sys.argv[1:]:
    print ' File to open: ' + filename
    with open(filename,"r") as file:
        data = file.read()

# decode the scope trace
trace = ScopeTrace.ScopeTrace(data,1)

# find baseline and jitter
baseline,jitter = trace.find_baseline_and_jitter(0,250)
#print ' Baseline: %10.6f,  Jitter: %10.6f'%(baseline,jitter)

inverted_yvalues = []
gaussian_values = []
landau_values = []

for value in trace.yvalues:
    inverted_yvalue = -(value-baseline)
    inverted_yvalues.append(inverted_yvalue)

amp = max(inverted_yvalues)
amp_idx= inverted_yvalues.index(amp)

x = trace.xvalues
for A, eta, mpv in ((1, 1, 10), (1,2,30), (.5, 5, 50)):
    plt.figure(1)
    y = np.array([pylandau.get_landau(x, mpv, eta, A) for x_value in x ])
    plt.plot(trace.xvalues, y)
    plt.plot(trace.xvalues, pylandau.landau(trace.xvalues, mpv, eta, A), '-', label = 'mu%1.1f, eta = %1.1f, A = %1.1f' % (mpv, eta, A))
   

# define the figure
fig = mlp.pyplot.gcf()
fig.set_size_inches(18.5, 14.5)

#FIGURE 1
plt.figure(2)
#plt.plot(trace.xvalues, inverted_yvalues, color = 'r')
#plt.plot(new_xvalues, gaussian_values, color = 'g') 
#plt.plot(new_xvalues, fitted_gaussian_values, color = 'b')
plt.title("Oscilloscope: gaussian_values", fontsize=28)
plt.xlabel('x-interval[n%s] '%trace.horizontal_units, fontsize=24)
plt.ylabel('y-reading [%s]'%trace.vertical_units, fontsize=24)
plt.xlim([200,700])
plt.ylim([-.3,.5])

#FIGURE 2
#plt.figure(3)
#plt.plot(trace.xvalues, inverted_yvalues, color = 'r')
#plt.plot(new_xvalues, landau_values, color = 'g')
#plt.title("Oscilloscope: landau_values", fontsize=28)
#plt.xlabel('x-interval[n%s] '%trace.horizontal_units, fontsize=24)
#plt.ylabel('y-reading [%s]'%trace.vertical_units, fontsize=24)

plt.show()
